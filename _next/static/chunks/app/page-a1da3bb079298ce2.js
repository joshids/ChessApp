(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{6514:function(e,t,a){Promise.resolve().then(a.bind(a,897))},897:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return F}});var r=a(7437),n=a(2265),s=a(6443),l=a(2746);let i={log:()=>{},error:()=>{},info:()=>{}};var o=a(8614),c=a(521);function d(e){let{message:t,type:a="info",isVisible:s,onClose:l,duration:i=4e3}=e;return(0,n.useEffect)(()=>{if(s&&i>0){let e=setTimeout(()=>{l()},i);return()=>clearTimeout(e)}},[s,i,l]),(0,r.jsx)(o.M,{children:s&&(0,r.jsx)(c.E.div,{"data-testid":"toast-notification","data-area":a,initial:{opacity:0,y:-50,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-20,scale:.95},transition:{type:"spring",stiffness:300,damping:25},className:"\n            fixed top-4 left-1/2 transform -translate-x-1/2 z-50\n            px-4 py-3 rounded-lg shadow-lg border\n            max-w-[90vw] md:max-w-md\n            ".concat({info:"bg-blue-50 dark:bg-blue-900/20 text-blue-800 dark:text-blue-200 border-blue-200 dark:border-blue-800",warning:"bg-yellow-50 dark:bg-yellow-900/20 text-yellow-800 dark:text-yellow-200 border-yellow-200 dark:border-yellow-800",error:"bg-red-50 dark:bg-red-900/20 text-red-800 dark:text-red-200 border-red-200 dark:border-red-800",success:"bg-green-50 dark:bg-green-900/20 text-green-800 dark:text-green-200 border-green-200 dark:border-green-800"}[a],"\n          "),children:(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("p",{"data-testid":"toast-message",className:"text-sm font-medium",children:t}),(0,r.jsx)("button",{onClick:l,className:"ml-2 p-1 rounded hover:bg-black/10 dark:hover:bg-white/10 transition-colors","aria-label":"Close notification",children:(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})})}let u={white:{default:[255,255,255]},gray:{100:[243,244,246],200:[229,231,235],300:[209,213,219],400:[156,163,175]},amber:{50:[255,251,235],100:[254,243,199],800:[133,77,14],900:[113,63,18]},stone:{100:[245,245,244],200:[231,229,228],600:[87,83,78],700:[68,64,60]},green:{100:[220,252,231],200:[187,247,208],700:[21,128,61],800:[22,101,52]},blue:{100:[219,234,254],200:[191,219,254],700:[29,78,216],800:[30,64,175]},purple:{100:[243,232,255],200:[233,213,255],700:[126,34,206],800:[107,33,168]}};function p(e,t){let a=(t?e.board.darkSquare:e.board.lightSquare).split(" ");return function(e){let t=e.replace("dark:","").trim().match(/^bg-(white|gray|amber|stone|green|blue|purple)(?:-(\d+))?$/);if(!t)return null;let[,a,r]=t;if("white"===a)return u.white.default;let n=r||"500",s=u[a];if(!s)return null;if(s[n])return s[n];let l=Object.keys(s);return l.length>0?s[l[0]]:null}(a.find(e=>e.startsWith("bg-")&&!e.startsWith("dark:"))||a[0])||[128,128,128]}function x(e){let{square:t,piece:a,pieceColor:s,isLight:l,skin:i,children:o,isSourceSquare:d=!1,isDestinationSquare:u=!1,isSelected:x=!1,isValidMove:g=!1,isCapturedSquare:h=!1,onClick:m,labels:b=[]}=e,f="".concat(l?i.board.lightSquare:i.board.darkSquare),y=(0,n.useRef)(null),w=(0,n.useRef)(!1);return(0,r.jsxs)(c.E.div,{layout:!0,"data-square":t,"data-selected":x?"true":"false","data-valid-move":g?"true":"false","data-source":d?"true":"false","data-destination":u?"true":"false","data-captured":h?"true":"false",className:"\n        w-full h-full\n        flex items-center justify-center\n        text-xl sm:text-2xl md:text-4xl\n        select-none\n        ".concat(f,"\n        transition-colors duration-200\n        relative\n        ").concat(m?"cursor-pointer":"","\n        ").concat(x?"square-selected":"","\n        ").concat(g?"square-valid-move":"","\n        ").concat(d?"square-source":"","\n        ").concat(u?"square-destination":"","\n        ").concat(h?"square-captured":"","\n      "),style:{...(()=>{if(x){console.log("[ChessSquare] getHighlightStyle - ".concat(t," is selected, applying blue border"));let[e,a,r]=p(i,l),n={backgroundImage:"repeating-linear-gradient(\n          45deg,\n          rgba(".concat(e,", ").concat(a,", ").concat(r,", 0.6),\n          rgba(").concat(e,", ").concat(a,", ").concat(r,", 0.6) 8px,\n          rgba(").concat(e,", ").concat(a,", ").concat(r,", 0.4) 8px,\n          rgba(").concat(e,", ").concat(a,", ").concat(r,", 0.4) 16px\n        )"),boxShadow:"inset 0 0 0 2px rgba(59, 130, 246, 0.8)"};return console.log("[ChessSquare] getHighlightStyle - ".concat(t," returning selected style:"),n),n}if(("e2"===t||"e4"===t||"e7"===t||"e5"===t||x)&&console.log("[ChessSquare] getHighlightStyle - ".concat(t," isSelected:"),x,"will return style with boxShadow:",x?"YES (blue border)":"NO"),h)return{backgroundImage:"repeating-linear-gradient(\n          45deg,\n          rgba(239, 68, 68, 0.6),\n          rgba(239, 68, 68, 0.6) 8px,\n          rgba(239, 68, 68, 0.4) 8px,\n          rgba(239, 68, 68, 0.4) 16px\n        )",boxShadow:"inset 0 0 0 3px rgba(239, 68, 68, 0.9)"};if(d||u){let[e,t,a]=p(i,l),r=d?.4:.5,n=d?.2:.3;return{backgroundImage:"repeating-linear-gradient(\n          45deg,\n          rgba(".concat(e,", ").concat(t,", ").concat(a,", ").concat(r,"),\n          rgba(").concat(e,", ").concat(t,", ").concat(a,", ").concat(r,") 10px,\n          rgba(").concat(e,", ").concat(t,", ").concat(a,", ").concat(n,") 10px,\n          rgba(").concat(e,", ").concat(t,", ").concat(a,", ").concat(n,") 20px\n        )"),boxShadow:"none"}}if(g)return{position:"relative",boxShadow:"none"};let e={backgroundImage:"none",boxShadow:"none"};return("e2"===t||"e4"===t||"e7"===t||"e5"===t)&&console.log("[ChessSquare] getHighlightStyle - ".concat(t," returning default style (no selection):"),e),e})(),touchAction:"manipulation"},whileHover:{scale:m?1.05:1},whileTap:{scale:m?.95:1},initial:{opacity:0},animate:{opacity:1},transition:{layout:{duration:.4,ease:[.4,0,.2,1]},opacity:{duration:.2}},onTouchStart:e=>{y.current=Date.now(),w.current=!1;let t=e.touches[0];t&&(e.currentTarget.dataset.touchStartX=t.clientX.toString(),e.currentTarget.dataset.touchStartY=t.clientY.toString())},onTouchEnd:e=>{let a=e.currentTarget,r=e.changedTouches[0],n=!0,s=!0;if(y.current){n=Date.now()-y.current<300;let e=parseFloat(a.dataset.touchStartX||"0"),t=parseFloat(a.dataset.touchStartY||"0");s=(r?Math.sqrt(Math.pow(r.clientX-e,2)+Math.pow(r.clientY-t,2)):1/0)<10}n&&s&&!w.current&&m&&(w.current=!0,console.log("[ChessSquare] Square touched:",t,"onClick handler exists:",!!m),e.preventDefault(),m(t)),y.current=null,delete a.dataset.touchStartX,delete a.dataset.touchStartY},onClick:e=>{if(w.current){e.preventDefault(),w.current=!1;return}console.log("[ChessSquare] Square clicked:",t,"onClick handler exists:",!!m),m&&m(t)},children:[g&&!a&&(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:(0,r.jsx)("div",{className:"w-2 h-2 sm:w-3 sm:h-3 md:w-4 md:h-4 rounded-full bg-blue-500 dark:bg-blue-400 opacity-60"})}),g&&a&&(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:(0,r.jsx)("div",{className:"w-full h-full rounded-full border-2 border-blue-500 dark:border-blue-400 opacity-60"})}),b.map((e,t)=>(0,r.jsx)("div",{className:"absolute text-xs sm:text-sm md:text-base font-semibold text-gray-700 dark:text-gray-300 pointer-events-none z-0 ".concat("top-left"===e.position?"top-1 left-1":"top-right"===e.position?"top-1 right-1":"bottom-left"===e.position?"bottom-1 left-1":"bottom-1 right-1"),children:e.text},t)),o||a&&(0,r.jsx)("span",{className:"white"===s?"".concat(i.pieces.whitePiece," ").concat(i.pieces.whitePieceShadow||""):"".concat(i.pieces.blackPiece," ").concat(i.pieces.blackPieceShadow||""),children:a})]})}function g(e){return{x:e[0].charCodeAt(0)-97,y:8-parseInt(e[1])}}let h={P:"Pawn",p:"Pawn",R:"Rook",r:"Rook",N:"Knight",n:"Knight",B:"Bishop",b:"Bishop",Q:"Queen",q:"Queen",K:"King",k:"King"};function m(e){let{isActive:t}=e;return t?(0,r.jsx)(c.E.div,{className:"absolute inset-0 pointer-events-none",initial:{scale:.8,opacity:.6},animate:{scale:[.8,1.4,1.2],opacity:[.6,.3,0]},transition:{duration:.6,ease:"easeOut",times:[0,.5,1]},style:{borderRadius:"50%",background:"radial-gradient(circle, rgba(59, 130, 246, 0.4) 0%, rgba(59, 130, 246, 0.1) 50%, transparent 100%)",transformOrigin:"center"}}):null}function b(e){let{isActive:t,particleCount:a=12}=e,[s,l]=(0,n.useState)([]);return((0,n.useEffect)(()=>{if(!t){l([]);return}let e=[];for(let t=0;t<a;t++){let r=t/a*Math.PI*2,n=30+(10*Math.random()-5),s=50+Math.cos(r)*n,l=50+Math.sin(r)*n;e.push({id:t,x:s,y:l,size:3+2*Math.random(),duration:.8+.4*Math.random(),delay:.2*Math.random()})}l(e);let r=setTimeout(()=>{l([])},2e3);return()=>clearTimeout(r)},[t,a]),t&&0!==s.length)?(0,r.jsx)("div",{className:"absolute inset-0 pointer-events-none overflow-hidden",children:s.map(e=>(0,r.jsx)(c.E.div,{className:"absolute rounded-full bg-blue-400 dark:bg-blue-300",initial:{x:"".concat(e.x,"%"),y:"".concat(e.y,"%"),scale:0,opacity:.8},animate:{x:"".concat(e.x+(20*Math.random()-10),"%"),y:"".concat(e.y+(20*Math.random()-10),"%"),scale:[0,1,0],opacity:[.8,1,0]},transition:{duration:e.duration,delay:e.delay,ease:"easeOut",repeat:0},style:{width:"".concat(e.size,"px"),height:"".concat(e.size,"px"),left:"50%",top:"50%",transform:"translate(-50%, -50%)",boxShadow:"0 0 4px rgba(59, 130, 246, 0.6)"}},e.id))}):null}let f={rippleEffect:!0,transform3DIntensity:"subtle",particleEffects:!1,toastNotifications:!0,pieceSize:80,pieceStyle:"unicode"},y={subtle:{rotateX:5,rotateY:5,rotateZ:0,scale:1.3,perspective:1e3,translateZ:20,transitionDuration:.3},medium:{rotateX:10,rotateY:10,rotateZ:2,scale:1.35,perspective:800,translateZ:40,transitionDuration:.35},strong:{rotateX:15,rotateY:15,rotateZ:5,scale:1.4,perspective:600,translateZ:60,transitionDuration:.4},crazy:{rotateX:20,rotateY:20,rotateZ:10,scale:1.5,perspective:400,translateZ:100,transitionDuration:.5}};function w(e){try{localStorage.setItem("chess-visual-effects",JSON.stringify(e))}catch(e){console.error("Error saving visual effects settings:",e)}}let k={K:"piece-king",Q:"piece-queen",R:"piece-rook",B:"piece-bishop",N:"piece-knight",P:"piece-pawn"};function v(e){let{piece:t,size:a=48,fill:n,stroke:s,strokeWidth:l=4,title:i,className:o,style:c,rotateDeg:d=0,flipX:u=!1,flipY:p=!1,disableNonScalingStroke:x=!1,autoOrient:g=!1,pieceColor:h}=e,m=k[t.toUpperCase()]||null;if(!m)return console.warn("[ChessPieceSvg] Unknown piece notation: ".concat(t)),null;let b=t===t.toUpperCase(),f=h||(b?"white":"black"),y=u,w=p;if(g){let e="piece-knight"===m?{flipX:"black"===f,flipY:!1}:{flipX:!1,flipY:!1};y=e.flipX,w=e.flipY}let v=[];0!==d&&v.push("rotate(".concat(d," 50 50)")),y&&v.push("translate(100 0) scale(-1 1)"),w&&v.push("translate(0 100) scale(1 -1)");let j=v.length>0?v.join(" "):void 0,S={"--piece-fill":n||("white"===f?"#ffffff":"#111111"),"--piece-stroke":s||("white"===f?"#111111":"#ffffff"),"--piece-stroke-width":"".concat(l),...c};return(0,r.jsxs)("svg",{width:a,height:a,viewBox:"0 0 100 100",className:o,style:S,"aria-hidden":!i,role:i?"img":void 0,children:[i&&(0,r.jsx)("title",{children:i}),(0,r.jsx)("use",{href:"#".concat(m),transform:j,style:{vectorEffect:x?void 0:"non-scaling-stroke"}})]})}function j(e){let{piece:t,pieceColor:a,skin:s,square:l,pieceType:o,isMoving:d=!1,fromSquare:u,animationSpeed:p,isSelected:x=!1,isCaptured:h=!1,rippleEffect:f=!0,transform3DIntensity:w="subtle",particleEffects:k=!1,pieceSize:j=80,pieceStyle:S="unicode"}=e,N=(()=>{if(!d||!u)return null;let e=g(u),t=g(l),a=window.innerWidth>=768?64:48;return{x:(e.x-t.x)*a,y:(e.y-t.y)*a}})();(0,n.useEffect)(()=>{if(d&&u&&N){let e=0===p?0:5e4/p,t=Date.now();if(i.log("[AnimatedPiece] \uD83C\uDFAC Animation STARTED at ".concat(t,":"),{from:u,to:l,speed:"".concat(p,"%"),transitionDuration:"".concat((50/p).toFixed(3),"s"),expectedDurationMs:"".concat(e.toFixed(2),"ms"),offset:N}),p>0){let a=t+e;i.log("[AnimatedPiece] ⏱️ Expected animation to complete at: ".concat(a," (in ").concat(e,"ms)")),setTimeout(()=>{let e=Date.now();i.log("[AnimatedPiece] ✅ Animation completed at ".concat(e,", took ").concat(e-t,"ms (expected ").concat(a-t,"ms)"))},e+50)}}},[d,u,l,p,N]);let C=()=>{if(0===p)return i.log("[AnimatedPiece] Transition: Instant (speed: 0%)"),{duration:0};let e=50/p;return i.log("[AnimatedPiece] Transition config:",{speed:"".concat(p,"%"),baseDuration:"".concat(.5,"s"),calculatedDuration:"".concat(e.toFixed(3),"s"),durationMs:"".concat((1e3*e).toFixed(0),"ms")}),{type:"tween",duration:e,ease:[.25,.1,.25,1]}},_=d&&u?"".concat(o,"-").concat(a,"-").concat(u,"-").concat(l):"".concat(o,"-").concat(a,"-").concat(l),q=x&&w?y[w]:null,E=x?(null==q?void 0:q.scale)||1.3:1,M=x?"drop-shadow(0 0 10px rgba(59, 130, 246, 0.9)) drop-shadow(0 0 16px rgba(59, 130, 246, 0.7)) drop-shadow(0 0 24px rgba(59, 130, 246, 0.5))":"none",P=q&&x?{rotateX:q.rotateX,rotateY:q.rotateY,rotateZ:q.rotateZ,translateZ:q.translateZ}:{rotateX:0,rotateY:0,rotateZ:0,translateZ:0},B=h?[1,1.5,1.2,1]:1,L=(null==q?void 0:q.transitionDuration)||.2,D=j/100,O=x?E*D:D,R=h?Array.isArray(B)?B.map(e=>e*D):B*D:D,I=Math.round(j/100*(window.innerWidth>=768?64:48)),T="white"===a?{fill:"#ffffff",stroke:"#111111"}:{fill:"#111111",stroke:"#ffffff"};return(0,r.jsxs)(c.E.span,{"data-piece-size":j,"data-piece-selected":x?"true":"false","data-piece-captured":h?"true":"false",initial:N?{x:N.x,y:N.y,scale:D,rotateX:0,rotateY:0,rotateZ:0}:{scale:D,rotateX:0,rotateY:0,rotateZ:0},animate:{x:0,y:0,scale:x?O:h?R:D,rotateX:P.rotateX,rotateY:P.rotateY,rotateZ:P.rotateZ},transition:{x:C(),y:C(),scale:{duration:x?L:h?.5:0,ease:x?"easeOut":h?[.4,0,.2,1]:"linear"},rotateX:{duration:L,ease:"easeOut"},rotateY:{duration:L,ease:"easeOut"},rotateZ:{duration:L,ease:"easeOut"}},style:{position:"absolute",width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",zIndex:d?20:x||h?15:10,transformOrigin:"center",filter:x?M:h&&h?"drop-shadow(0 0 12px rgba(239, 68, 68, 1)) drop-shadow(0 0 20px rgba(239, 68, 68, 0.8)) drop-shadow(0 0 30px rgba(239, 68, 68, 0.6))":"none",transition:"filter 0.2s ease-out",perspective:(null==q?void 0:q.perspective)||"none",transformStyle:"preserve-3d"},children:[f&&x&&(0,r.jsx)(m,{isActive:x}),k&&x&&(0,r.jsx)(b,{isActive:x}),"svg"===S?(0,r.jsx)(v,{piece:o,size:I,fill:T.fill,stroke:T.stroke,strokeWidth:4,autoOrient:!0,pieceColor:a,className:"pointer-events-none"}):(0,r.jsx)("span",{className:"white"===a?"".concat(s.pieces.whitePiece," ").concat(s.pieces.whitePieceShadow||""):"".concat(s.pieces.blackPiece," ").concat(s.pieces.blackPieceShadow||""),children:t})]},_)}let S=["a","b","c","d","e","f","g","h"],N=["8","7","6","5","4","3","2","1"];function C(e){let{fen:t,skin:a,previousFen:s,lastMove:l,animationSpeed:i,selectedSquare:o,validMoves:c=[],capturedSquare:d,rippleEffect:u=!0,transform3DIntensity:p="subtle",particleEffects:g=!1,pieceSize:h=80,pieceStyle:m="unicode",onSquareClick:b}=e,f=e=>{let t=[],a=e.split(" ")[0].split("/");for(let e=0;e<8;e++){let r=a[e],n=0;for(let a of r)if(a>="1"&&a<="8"){let r=parseInt(a);for(let a=0;a<r;a++){let a=S[n]+N[e],r=(e+n)%2==0;t.push({square:a,piece:null,color:r?"light":"dark"}),n++}}else{let r=S[n]+N[e],s=(e+n)%2==0;t.push({square:r,piece:a,color:s?"light":"dark"}),n++}}return t},y=(0,n.useMemo)(()=>f(t),[t]),w=(0,n.useMemo)(()=>s?f(s):null,[s]),k=(0,n.useMemo)(()=>{if(!l||!w)return null;let e=w.find(e=>e.square===l.from);return e&&e.piece?{piece:e.piece,from:l.from,to:l.to}:null},[l,w]),v=e=>e&&({P:"♙",p:"♟",R:"♖",r:"♜",N:"♘",n:"♞",B:"♗",b:"♝",Q:"♕",q:"♛",K:"♔",k:"♚"})[e]||"",C=e=>e?e===e.toUpperCase()?"white":"black":null,_=e=>{let t=e[0],a=e[1],r=[];return"8"===a&&r.push({position:"top-left",text:t}),"1"===a&&r.push({position:"bottom-left",text:t}),"a"===t&&r.push({position:"top-left",text:a}),"h"===t&&r.push({position:"top-right",text:a}),r};return(0,r.jsx)("div",{className:"flex flex-col items-center w-full",children:(0,r.jsx)("div",{className:"w-full aspect-square max-w-full",children:(0,r.jsx)("div",{className:"grid grid-cols-8 grid-rows-8 h-full w-full border-4 border-gray-800 dark:border-gray-600 shadow-lg relative",children:y.map((e,t)=>{let{square:n,piece:s,color:f}=e,y=v(s),w=C(s),S=_(n);return(0,r.jsx)(x,{square:n,piece:y,pieceColor:w,isLight:"light"===f,skin:a,isSourceSquare:null!=l&&l.from===n,isDestinationSquare:null!=l&&l.to===n,isSelected:(()=>{let e=null!=o&&o===n;return(n===o||"e2"===n||"e4"===n||"e7"===n||"e5"===n)&&console.log("[ChessBoard] Square ".concat(n," isSelected:"),e,"selectedSquare:",o),e})(),isValidMove:c&&c.includes(n),isCapturedSquare:d===n,onClick:b,labels:S,children:y&&w&&s&&(0,r.jsx)(j,{piece:y,pieceColor:w,skin:a,square:n,pieceType:s,isMoving:(null==k?void 0:k.piece)===s&&(null==k?void 0:k.to)===n,fromSquare:(null==k?void 0:k.from)===n?n:void 0,animationSpeed:i,isSelected:o===n,isCaptured:d===n&&(null==l?void 0:l.to)===n,rippleEffect:u,transform3DIntensity:p,particleEffects:g,pieceSize:h,pieceStyle:m},"".concat(s,"-").concat(w,"-").concat(n,"-").concat((null==k?void 0:k.from)||"","-").concat((null==k?void 0:k.to)||""))},"".concat(n,"-").concat(a.id))})})})})}function _(e){let{isOpen:t,onClose:a,side:s,children:l,title:i}=e,d=(0,n.useRef)(null),u=(0,n.useRef)(null),[p,x]=(0,n.useState)(!1),[g,h]=(0,n.useState)(0);(0,n.useEffect)(()=>{let e=e=>{"Escape"===e.key&&t&&a()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[t,a]),(0,n.useEffect)(()=>(t?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[t]);let m="right"===s;return(0,n.useEffect)(()=>{if(t){let e=Math.min(.85*window.innerWidth,320);document.documentElement.style.setProperty("--drawer-width","".concat(e,"px"))}},[t]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.M,{children:t&&(0,r.jsx)(c.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"fixed inset-0 bg-black/50 z-40 md:hidden",onClick:a})}),(0,r.jsx)(o.M,{children:t&&(0,r.jsxs)(c.E.div,{"data-testid":m?"right-drawer":"left-drawer",ref:d,initial:{x:m?"100%":"-100%"},animate:{x:p?g:0},exit:{x:m?"100%":"-100%"},transition:{type:"spring",stiffness:300,damping:30},className:"\n              fixed top-0 bottom-0 z-50\n              ".concat(m?"right-0":"left-0","\n              w-[85vw] max-w-[320px]\n              bg-white dark:bg-slate-800\n              shadow-2xl\n              md:hidden\n              flex flex-col\n            "),style:{width:"min(85vw, 320px)"},onTouchStart:e=>{let t=e.touches[0];u.current={x:t.clientX,y:t.clientY,time:Date.now()},x(!0)},onTouchMove:e=>{if(!u.current||!t)return;let a=e.touches[0],r=a.clientX-u.current.x;Math.abs(r)>Math.abs(a.clientY-u.current.y)&&Math.abs(r)>10&&(e.preventDefault(),"right"===s?r<0&&h(r):r>0&&h(r))},onTouchEnd:()=>{u.current&&(Math.abs(g)>100&&a(),h(0),x(!1),u.current=null)},children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[i&&(0,r.jsx)("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:i}),(0,r.jsx)("button",{"data-testid":m?"close-right-drawer-button":"close-left-drawer-button",onClick:a,className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors","aria-label":"Close drawer",children:(0,r.jsx)("svg",{className:"w-6 h-6 text-gray-600 dark:text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,r.jsx)("div",{"data-testid":m?"right-drawer-content":"left-drawer-content",className:"flex-1 overflow-y-auto p-4",children:l})]})})]})}let q={Q:5,q:5,R:4,r:4,B:3,b:3,N:2,n:2,P:1,p:1},E={P:"♙",p:"♟",R:"♖",r:"♜",N:"♘",n:"♞",B:"♗",b:"♝",Q:"♕",q:"♛",K:"♔",k:"♚"};function M(e){let{capturedPieces:t,color:a,skin:n,pieceStyle:s="unicode"}=e,l=[...t].sort((e,t)=>{let a=q[e]||0,r=q[t]||0;return a!==r?r-a:e.localeCompare(t)}),i={};for(let e of l)i[e]=(i[e]||0)+1;let o=e=>e===e.toUpperCase()?"".concat(n.pieces.whitePiece," ").concat(n.pieces.whitePieceShadow||""):"".concat(n.pieces.blackPiece," ").concat(n.pieces.blackPieceShadow||"");if(0===l.length)return(0,r.jsx)("div",{"data-testid":"captured-pieces-empty",className:"min-h-[3rem] flex items-center justify-center text-gray-400 dark:text-gray-600 text-sm",children:"No pieces lost"});let c=e=>e===e.toUpperCase()?{fill:"#ffffff",stroke:"#111111"}:{fill:"#111111",stroke:"#ffffff"};return(0,r.jsx)("div",{"data-testid":"captured-pieces-".concat(a),className:"flex flex-wrap items-center gap-1 min-h-[3rem] p-2 bg-slate-50 dark:bg-slate-800 rounded-lg border border-gray-200 dark:border-gray-700",children:Object.entries(i).map(e=>{let[t,a]=e,n=c(t),l=t===t.toUpperCase()?"white":"black";return(0,r.jsxs)("div",{className:"flex items-center gap-1",title:"".concat(a>1?"".concat(a,"x "):"").concat(t.toUpperCase()),children:["svg"===s?(0,r.jsx)(v,{piece:t,size:32,fill:n.fill,stroke:n.stroke,strokeWidth:3,autoOrient:!0,pieceColor:l}):(0,r.jsx)("span",{className:"text-xl md:text-2xl ".concat(o(t)),children:E[t]}),a>1&&(0,r.jsx)("span",{"data-testid":"captured-piece-count-".concat(t),className:"text-xs text-gray-600 dark:text-gray-400 font-semibold",children:a})]},t)})})}function P(e){let{isCheck:t,isCheckmate:a,isStalemate:n,isDraw:s,currentTurn:l}=e,i=a?{text:"Checkmate! ".concat("w"===l?"Black":"White"," wins!"),color:"text-red-600 dark:text-red-400",bg:"bg-red-50 dark:bg-red-900/20"}:n?{text:"Stalemate! The game is a draw.",color:"text-yellow-600 dark:text-yellow-400",bg:"bg-yellow-50 dark:bg-yellow-900/20"}:s?{text:"Draw!",color:"text-yellow-600 dark:text-yellow-400",bg:"bg-yellow-50 dark:bg-yellow-900/20"}:t?{text:"Check! ".concat("w"===l?"White":"Black"," is in check."),color:"text-orange-600 dark:text-orange-400",bg:"bg-orange-50 dark:bg-orange-900/20"}:null;return i?(0,r.jsx)(c.E.div,{"data-testid":"game-status",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{type:"spring",stiffness:300,damping:20},className:"".concat(i.bg," ").concat(i.color," rounded-lg p-3 text-center font-semibold"),children:i.text}):null}function B(e){if("Gold Enhanced"===e)return{firstColor:"Gold",secondColor:"Silver"};let t=e.split(" & ");return 2===t.length?{firstColor:t[0].trim(),secondColor:t[1].trim()}:{firstColor:"White",secondColor:"Black"}}function L(e){let{firstColor:t}=B(e.pieces.name);return"".concat(t,"'s Lost Pieces:")}function D(e){let{secondColor:t}=B(e.pieces.name);return"".concat(t,"'s Lost Pieces:")}function O(e){let{moveHistory:t,capturedWhite:a,capturedBlack:n,skin:s,isCheck:l,isCheckmate:i,isStalemate:o,isDraw:c,currentTurn:d,pieceStyle:u="unicode"}=e;return(0,r.jsxs)("div",{"data-testid":"right-drawer-content-wrapper",className:"space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"Game Status"}),(0,r.jsx)(P,{isCheck:l,isCheckmate:i,isStalemate:o,isDraw:c,currentTurn:d})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:D(s)}),(0,r.jsx)(M,{capturedPieces:n,color:"black",skin:s,pieceStyle:u})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:L(s)}),(0,r.jsx)(M,{capturedPieces:a,color:"white",skin:s,pieceStyle:u})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"Move History"}),(0,r.jsx)("div",{className:"bg-slate-100 dark:bg-slate-700 rounded-lg p-3 max-h-64 overflow-y-auto",children:0===t.length?(0,r.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"No moves yet"}):(0,r.jsx)("div",{className:"text-sm font-mono space-y-1",children:t.map((e,a)=>(0,r.jsxs)("div",{className:"text-gray-700 dark:text-gray-300 py-1",children:[Math.floor(a/2)+1,". ",a%2==0?"":t[a-1]+" ",e]},a))})})]})]})}function R(e){let{onMove:t,disabled:a,error:s}=e,[l,i]=(0,n.useState)("");return(0,r.jsxs)("div",{className:"bg-slate-100 dark:bg-slate-700 rounded-lg p-4",children:[(0,r.jsx)("h2",{className:"font-semibold text-gray-900 dark:text-white mb-3",children:"Make a Move"}),(0,r.jsxs)("form",{onSubmit:e=>{e.preventDefault(),l.trim()&&!a&&(t(l.trim()),i(""))},className:"space-y-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("input",{"data-testid":"move-input",type:"text",value:l,onChange:e=>i(e.target.value),placeholder:"e.g., e2e4, Nf3, O-O, Qd1h5",disabled:a,className:"\n              w-full px-4 py-2 rounded-lg border-2\n              bg-white dark:bg-slate-600\n              text-gray-900 dark:text-white\n              placeholder-gray-500 dark:placeholder-gray-400\n              focus:outline-none focus:ring-2 focus:ring-blue-500\n              disabled:opacity-50 disabled:cursor-not-allowed\n              font-mono text-sm\n              ".concat(s?"border-red-500":"border-gray-300 dark:border-gray-500","\n            ")}),s&&(0,r.jsx)(c.E.p,{"data-testid":"move-input-error",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"mt-2 text-sm text-red-600 dark:text-red-400",children:s})]}),(0,r.jsx)("button",{"data-testid":"move-input-button",type:"submit",disabled:a||!l.trim(),className:"\n            w-full py-2 px-4 rounded-lg font-semibold\n            transition-all duration-200\n            ".concat(a||!l.trim()?"bg-gray-400 dark:bg-gray-600 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 active:scale-95","\n            text-white\n          "),children:a?"Game Over":"Make Move"})]}),(0,r.jsxs)("div",{className:"mt-4 text-xs text-gray-600 dark:text-gray-400",children:[(0,r.jsx)("p",{className:"font-semibold mb-1",children:"Notation Examples:"}),(0,r.jsxs)("ul",{className:"list-disc list-inside space-y-1 ml-2",children:[(0,r.jsx)("li",{children:"Long: e2e4, d7d5"}),(0,r.jsx)("li",{children:"Short: Nf3, Bb5, Qd1"}),(0,r.jsx)("li",{children:"Castling: O-O, O-O-O"}),(0,r.jsx)("li",{children:"Capture: exd5, Nxe5"}),(0,r.jsx)("li",{children:"Check: Qh5+, Nf3#"})]})]})]})}function I(e){let{onReplay:t,onStop:a,isReplaying:s,disabled:l}=e,[i,o]=(0,n.useState)(""),[c,d]=(0,n.useState)(!1);return(0,n.useEffect)(()=>{s||d(!1)},[s]),(0,r.jsxs)("div",{className:"bg-slate-100 dark:bg-slate-700 rounded-lg p-4",children:[(0,r.jsx)("h2",{className:"font-semibold text-gray-900 dark:text-white mb-3",children:"Replay Mode"}),(0,r.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),i.trim()&&!l&&!s){let e=i.split(/[,\s\n]+/).map(e=>e.trim()).filter(e=>e.length>0);e.length>0&&(d(!0),t(e))}},className:"space-y-3",children:[(0,r.jsx)("div",{children:(0,r.jsx)("textarea",{value:i,onChange:e=>o(e.target.value),placeholder:"Enter moves separated by commas or spaces e.g., e2e4 e7e5 Nf3 Nc6 Bb5",disabled:l||s,rows:4,className:"\n              w-full px-4 py-2 rounded-lg border-2\n              bg-white dark:bg-slate-600\n              text-gray-900 dark:text-white\n              placeholder-gray-500 dark:placeholder-gray-400\n              focus:outline-none focus:ring-2 focus:ring-blue-500\n              disabled:opacity-50 disabled:cursor-not-allowed\n              font-mono text-sm\n              resize-none\n            "})}),s?(0,r.jsx)("button",{type:"button",onClick:()=>{d(!1),a()},className:"w-full py-2 px-4 rounded-lg font-semibold bg-red-600 hover:bg-red-700 text-white transition-all duration-200 active:scale-95",children:"Stop Replay"}):(0,r.jsx)("button",{type:"submit",disabled:l||!i.trim()||s,className:"\n              w-full py-2 px-4 rounded-lg font-semibold\n              transition-all duration-200\n              ".concat(l||!i.trim()||s?"bg-gray-400 dark:bg-gray-600 cursor-not-allowed":"bg-green-600 hover:bg-green-700 active:scale-95","\n              text-white\n            "),children:"Start Replay"})]}),(0,r.jsxs)("div",{className:"mt-4 text-xs text-gray-600 dark:text-gray-400",children:[(0,r.jsx)("p",{className:"font-semibold mb-1",children:"Instructions:"}),(0,r.jsxs)("ul",{className:"list-disc list-inside space-y-1 ml-2",children:[(0,r.jsx)("li",{children:"Enter multiple moves separated by spaces or commas"}),(0,r.jsx)("li",{children:"Moves will be played automatically"}),(0,r.jsx)("li",{children:'Click "Stop Replay" to pause'})]})]})]})}function T(e){let{selectedSkin:t,onSkinChange:a}=e;return(0,r.jsxs)("div",{className:"bg-slate-100 dark:bg-slate-700 rounded-lg p-4",children:[(0,r.jsx)("h2",{className:"font-semibold text-gray-900 dark:text-white mb-3",children:"Board & Piece Skins"}),(0,r.jsx)("div",{className:"grid grid-cols-2 gap-2",children:l.g6.map(e=>(0,r.jsxs)(c.E.button,{onClick:()=>a(e),className:"\n              p-3 rounded-lg border-2 transition-all duration-200\n              ".concat(t.id===e.id?"border-blue-600 bg-blue-50 dark:bg-blue-900/20":"border-gray-300 dark:border-gray-600 bg-white dark:bg-slate-600 hover:border-blue-400","\n            "),whileHover:{scale:1.02},whileTap:{scale:.98},children:[(0,r.jsx)("div",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-1",children:e.name}),(0,r.jsxs)("div",{className:"flex gap-1 justify-center",children:[(0,r.jsx)("div",{className:"w-4 h-4 rounded ".concat(e.board.lightSquare)}),(0,r.jsx)("div",{className:"w-4 h-4 rounded ".concat(e.board.darkSquare)})]}),(0,r.jsxs)("div",{className:"flex gap-1 justify-center mt-1",children:[(0,r.jsx)("span",{className:"text-xs ".concat(e.pieces.whitePiece),children:"♔"}),(0,r.jsx)("span",{className:"text-xs ".concat(e.pieces.blackPiece),children:"♚"})]})]},e.id))})]})}let z=[{value:"subtle",label:"Subtle",description:"Gentle 3D effect"},{value:"medium",label:"Medium",description:"Moderate 3D effect"},{value:"strong",label:"Strong",description:"Pronounced 3D effect"},{value:"crazy",label:"Crazy",description:"Maximum 3D effect"}];function W(e){let{settings:t,onSettingsChange:a}=e,n=e=>{a({...t,[e]:!t[e]})},s=e=>{a({...t,transform3DIntensity:e})};return(0,r.jsxs)("div",{className:"bg-slate-100 dark:bg-slate-700 rounded-lg p-4 space-y-4",children:[(0,r.jsx)("h2",{className:"font-semibold text-gray-900 dark:text-white mb-3",children:"Visual Effects"}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("label",{className:"text-sm font-medium text-gray-900 dark:text-white cursor-pointer",children:"Ripple Effect"}),(0,r.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-0.5",children:"Expanding ripple on piece selection"})]}),(0,r.jsx)("button",{onClick:()=>n("rippleEffect"),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors ".concat(t.rippleEffect?"bg-blue-600":"bg-gray-300 dark:bg-gray-600"),role:"switch","aria-checked":t.rippleEffect,children:(0,r.jsx)("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform ".concat(t.rippleEffect?"translate-x-6":"translate-x-1")})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm font-medium text-gray-900 dark:text-white mb-2 block",children:"3D Transform Intensity"}),(0,r.jsx)("div",{className:"grid grid-cols-2 gap-2",children:z.map(e=>(0,r.jsxs)(c.E.button,{onClick:()=>s(e.value),className:"p-2 rounded-lg border-2 text-xs transition-all ".concat(t.transform3DIntensity===e.value?"border-blue-600 bg-blue-50 dark:bg-blue-900/20 text-blue-900 dark:text-blue-300":"border-gray-300 dark:border-gray-600 bg-white dark:bg-slate-600 text-gray-700 dark:text-gray-300 hover:border-blue-400"),whileHover:{scale:1.02},whileTap:{scale:.98},children:[(0,r.jsx)("div",{className:"font-semibold",children:e.label}),(0,r.jsx)("div",{className:"text-xs opacity-75",children:e.description})]},e.value))})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("label",{className:"text-sm font-medium text-gray-900 dark:text-white cursor-pointer",children:"Particle Effects"}),(0,r.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-0.5",children:"Animated particles around selected pieces"})]}),(0,r.jsx)("button",{onClick:()=>n("particleEffects"),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors ".concat(t.particleEffects?"bg-blue-600":"bg-gray-300 dark:bg-gray-600"),role:"switch","aria-checked":t.particleEffects,children:(0,r.jsx)("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform ".concat(t.particleEffects?"translate-x-6":"translate-x-1")})})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("label",{className:"text-sm font-medium text-gray-900 dark:text-white cursor-pointer",children:"Toast Notifications"}),(0,r.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-0.5",children:"Show notifications for captures and game events"})]}),(0,r.jsx)("button",{onClick:()=>n("toastNotifications"),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors ".concat(t.toastNotifications?"bg-blue-600":"bg-gray-300 dark:bg-gray-600"),role:"switch","aria-checked":t.toastNotifications,children:(0,r.jsx)("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform ".concat(t.toastNotifications?"translate-x-6":"translate-x-1")})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm font-medium text-gray-900 dark:text-white mb-2 block",children:"Piece Style"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,r.jsxs)(c.E.button,{onClick:()=>{a({...t,pieceStyle:"unicode"})},className:"p-2 rounded-lg border-2 text-xs transition-all ".concat("unicode"===t.pieceStyle?"border-blue-600 bg-blue-50 dark:bg-blue-900/20 text-blue-900 dark:text-blue-300":"border-gray-300 dark:border-gray-600 bg-white dark:bg-slate-600 text-gray-700 dark:text-gray-300 hover:border-blue-400"),whileHover:{scale:1.02},whileTap:{scale:.98},children:[(0,r.jsx)("div",{className:"font-semibold",children:"Unicode"}),(0,r.jsx)("div",{className:"text-xs opacity-75",children:"Text symbols"})]}),(0,r.jsxs)(c.E.button,{onClick:()=>{a({...t,pieceStyle:"svg"})},className:"p-2 rounded-lg border-2 text-xs transition-all ".concat("svg"===t.pieceStyle?"border-blue-600 bg-blue-50 dark:bg-blue-900/20 text-blue-900 dark:text-blue-300":"border-gray-300 dark:border-gray-600 bg-white dark:bg-slate-600 text-gray-700 dark:text-gray-300 hover:border-blue-400"),whileHover:{scale:1.02},whileTap:{scale:.98},children:[(0,r.jsx)("div",{className:"font-semibold",children:"SVG"}),(0,r.jsx)("div",{className:"text-xs opacity-75",children:"Vector graphics"})]})]}),(0,r.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:"Choose how chess pieces are rendered"})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"text-sm font-medium text-gray-900 dark:text-white mb-2 block",children:["Piece Size: ",t.pieceSize,"%"]}),(0,r.jsx)("input",{type:"range",min:"60",max:"100",step:"5",value:t.pieceSize,onChange:e=>{let r=parseInt(e.target.value,10);a({...t,pieceSize:r})},className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700"}),(0,r.jsxs)("div",{className:"flex justify-between text-xs text-gray-600 dark:text-gray-400 mt-1",children:[(0,r.jsx)("span",{children:"60%"}),(0,r.jsx)("span",{children:"80%"}),(0,r.jsx)("span",{children:"100%"})]}),(0,r.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:"Adjust the size of pieces relative to squares"})]})]})}var G=a(7648);let X=(0,n.forwardRef)(function(e,t){let{fen:a,previousFen:s,lastMove:l,selectedSquare:i,validMoves:o,capturedSquare:c,rippleEffect:d=!0,transform3DIntensity:u="subtle",particleEffects:p=!1,pieceSize:x,onSquareClick:g,chess:h,moveHistory:m,capturedWhite:b,capturedBlack:f,isCheck:y,isCheckmate:w,isStalemate:k,isDraw:v,selectedSkin:j,animationSpeed:S,replayMode:N,isReplaying:q,isGameOver:E,error:M,isRightDrawerOpen:P,isLeftDrawerOpen:B,setIsRightDrawerOpen:L,setIsLeftDrawerOpen:D,onMove:z,onReplay:X,onStopReplay:Y,onSkinChange:A,onAnimationSpeedChange:F,onResetGame:H,onSetReplayMode:Z,visualEffects:Q,onVisualEffectsChange:U,onCopyBoard:K,onLoadBoard:V}=e,[J,$]=(0,n.useState)(!1),[ee,et]=(0,n.useState)(""),ea=async()=>{ee.trim()&&(V(ee),et(""),$(!1),await es("left"))},er=()=>new Promise(e=>{requestAnimationFrame(()=>{setTimeout(e,450)})}),en=async e=>{"left"===e?B||(D(!0),await er()):P||(L(!0),await er())},es=async e=>{"left"===e?B&&(D(!1),await er()):P&&(L(!1),await er())},el=e=>"left"===e?B:P;return(0,n.useImperativeHandle)(t,()=>({openDrawer:en,closeDrawer:es,isDrawerOpen:el})),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"fixed inset-0 bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 flex flex-col","data-chess-game-mobile":!0,children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-3 bg-white/10 dark:bg-slate-800/10 backdrop-blur-sm",children:[(0,r.jsx)("button",{"data-testid":"open-left-drawer-button",onClick:()=>en("left"),className:"p-2 rounded-lg bg-white/20 dark:bg-slate-700/20 hover:bg-white/30 dark:hover:bg-slate-700/30 transition-colors","aria-label":"Open menu",children:(0,r.jsx)("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("h1",{className:"text-lg font-bold text-white",children:"Chess Game"}),(0,r.jsx)(G.default,{href:"/help",className:"p-1.5 rounded-lg bg-white/20 dark:bg-slate-700/20 hover:bg-white/30 dark:hover:bg-slate-700/30 transition-colors",title:"Help & Instructions","aria-label":"Help & Instructions",children:(0,r.jsx)("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})]}),(0,r.jsx)("button",{"data-testid":"open-right-drawer-button",onClick:()=>en("right"),className:"p-2 rounded-lg bg-white/20 dark:bg-slate-700/20 hover:bg-white/30 dark:hover:bg-slate-700/30 transition-colors","aria-label":"Open game info",children:(0,r.jsx)("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})})]}),(0,r.jsx)("div",{className:"flex-1 flex items-center justify-center p-2 overflow-hidden transition-transform duration-300 ease-out",style:{transform:P?"translateX(calc(-1 * min(85vw, 320px)))":B?"translateX(min(85vw, 320px))":"translateX(0)"},children:(0,r.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,r.jsx)("div",{className:"w-full max-w-full aspect-square",children:(0,r.jsx)(C,{fen:a,skin:j,previousFen:s,lastMove:l,animationSpeed:S,selectedSquare:i,validMoves:o,capturedSquare:c,rippleEffect:d,transform3DIntensity:u,particleEffects:p,pieceSize:x,pieceStyle:(null==Q?void 0:Q.pieceStyle)||"unicode",...g?{onSquareClick:g}:{}})})})}),(0,r.jsx)("div",{className:"p-3 bg-white/10 dark:bg-slate-800/10 backdrop-blur-sm text-center",children:(0,r.jsxs)("p",{className:"text-sm text-white",children:["Current turn: ",(0,r.jsx)("span",{className:"font-semibold",children:"w"===h.turn()?"White":"Black"})]})})]}),(0,r.jsx)(_,{isOpen:P,onClose:()=>es("right"),side:"right",title:"Game Information",children:(0,r.jsx)(O,{moveHistory:m,capturedWhite:b,capturedBlack:f,skin:j,isCheck:y,isCheckmate:w,isStalemate:k,isDraw:v,currentTurn:h.turn(),pieceStyle:(null==Q?void 0:Q.pieceStyle)||"unicode"})}),(0,r.jsx)(_,{isOpen:B,onClose:()=>es("left"),side:"left",title:"Settings & Controls",children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:async()=>{Z(!1),await es("left")},className:"flex-1 py-2 px-4 rounded-lg font-semibold transition-colors duration-200 ".concat(N?"bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300":"bg-blue-600 text-white"),children:"Play"}),(0,r.jsx)("button",{onClick:async()=>{Z(!0),await es("left")},className:"flex-1 py-2 px-4 rounded-lg font-semibold transition-colors duration-200 ".concat(N?"bg-blue-600 text-white":"bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300"),children:"Replay"})]}),N?(0,r.jsx)(I,{onReplay:X,onStop:Y,isReplaying:q,disabled:E}):(0,r.jsx)(R,{onMove:z,disabled:E||q,error:M}),(0,r.jsx)(T,{selectedSkin:j,onSkinChange:A}),Q&&U&&(0,r.jsx)(W,{settings:Q,onSettingsChange:U}),(0,r.jsxs)("div",{className:"bg-slate-100 dark:bg-slate-700 rounded-lg p-4","data-testid":"animation-speed-section",children:[(0,r.jsx)("h2",{className:"font-semibold text-gray-900 dark:text-white mb-3",children:"Animation Speed"}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsx)("span",{className:"text-sm text-gray-700 dark:text-gray-300","data-testid":"animation-speed-label",children:"Speed"}),(0,r.jsxs)("span",{className:"text-sm font-semibold text-gray-900 dark:text-white","data-testid":"animation-speed-percentage",children:[S,"%"]})]}),(0,r.jsx)("input",{type:"range",min:"0",max:"200",step:"10",value:S,onChange:e=>F(parseInt(e.target.value,10)),className:"w-full h-2 bg-gray-200 dark:bg-gray-600 rounded-lg appearance-none cursor-pointer accent-blue-600","data-testid":"animation-speed-slider",style:{background:"linear-gradient(to right, rgb(37, 99, 235) 0%, rgb(37, 99, 235) ".concat(S/200*100,"%, rgb(229, 231, 235) ").concat(S/200*100,"%, rgb(229, 231, 235) 100%)")}}),(0,r.jsxs)("div",{className:"flex justify-between text-xs text-gray-500 dark:text-gray-400",children:[(0,r.jsx)("span",{children:"0%"}),(0,r.jsx)("span",{children:"100%"}),(0,r.jsx)("span",{children:"200%"})]}),(0,r.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-2",children:0===S?"Instant (no animation)":S<100?"Slower":100===S?"Normal speed":"Faster"})]})]}),(0,r.jsxs)("div",{className:"bg-slate-100 dark:bg-slate-700 rounded-lg p-4",children:[(0,r.jsx)("h2",{className:"font-semibold text-gray-900 dark:text-white mb-3",children:"Board Management"}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("button",{onClick:async()=>{K(),await es("left")},className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors duration-200 flex items-center justify-center gap-2",children:[(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),"Copy Board"]}),(0,r.jsxs)("button",{onClick:async()=>{$(!0),await es("left")},className:"w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors duration-200 flex items-center justify-center gap-2",children:[(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),"Load Board"]})]})]}),(0,r.jsx)("button",{onClick:async()=>{H(),await es("left")},className:"w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors duration-200",children:"Reset Game"})]})}),J&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,r.jsxs)("div",{className:"bg-white dark:bg-slate-800 rounded-lg p-6 max-w-md w-full shadow-xl",children:[(0,r.jsx)("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-4",children:"Load Board Position"}),(0,r.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:"Paste the copied board position (text or JSON format):"}),(0,r.jsx)("textarea",{value:ee,onChange:e=>et(e.target.value),placeholder:"Paste board position here...",className:"w-full h-32 p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-700 text-gray-900 dark:text-white font-mono text-sm resize-none"}),(0,r.jsxs)("div",{className:"flex gap-2 mt-4",children:[(0,r.jsx)("button",{onClick:ea,disabled:!ee.trim(),className:"flex-1 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-semibold py-2 px-4 rounded-lg transition-colors duration-200",children:"Load"}),(0,r.jsx)("button",{onClick:()=>{$(!1),et("")},className:"flex-1 bg-gray-300 dark:bg-gray-600 hover:bg-gray-400 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 font-semibold py-2 px-4 rounded-lg transition-colors duration-200",children:"Cancel"})]})]})})]})});function Y(e){let{fen:t,previousFen:a,lastMove:s,selectedSquare:l,validMoves:i,capturedSquare:o,rippleEffect:c=!0,transform3DIntensity:d="subtle",particleEffects:u=!1,pieceSize:p,onSquareClick:x,chess:g,moveHistory:h,capturedWhite:m,capturedBlack:b,isCheck:f,isCheckmate:y,isStalemate:w,isDraw:k,selectedSkin:v,animationSpeed:j,replayMode:S,isReplaying:N,isGameOver:_,error:q,onMove:E,onReplay:B,onStopReplay:O,onSkinChange:z,onAnimationSpeedChange:X,onResetGame:Y,onSetReplayMode:A,visualEffects:F,onVisualEffectsChange:H,onCopyBoard:Z,onLoadBoard:Q}=e,[U,K]=(0,n.useState)(!1),[V,J]=(0,n.useState)("");return(0,r.jsxs)("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-2xl p-6 lg:p-8 max-w-6xl w-full",children:[(0,r.jsxs)("div",{className:"flex flex-col lg:flex-row gap-6",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-center gap-3 mb-2",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-center text-gray-900 dark:text-white",children:"Chess Game"}),(0,r.jsx)(G.default,{href:"/help",className:"inline-flex items-center justify-center w-8 h-8 rounded-full bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-400 hover:bg-blue-200 dark:hover:bg-blue-800 transition-colors",title:"Help & Instructions","aria-label":"Help & Instructions",children:(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})]}),(0,r.jsxs)("p",{className:"text-center text-gray-600 dark:text-gray-400 text-sm",children:["Current turn: ",(0,r.jsx)("span",{className:"font-semibold",children:"w"===g.turn()?"White":"Black"})]})]}),(0,r.jsxs)("div",{className:"mb-2",children:[(0,r.jsx)("div",{className:"text-xs font-semibold text-gray-700 dark:text-gray-300 mb-1",children:D(v)}),(0,r.jsx)(M,{capturedPieces:b,color:"black",skin:v,pieceStyle:(null==F?void 0:F.pieceStyle)||"unicode"})]}),(0,r.jsx)(C,{fen:t,skin:v,previousFen:a,lastMove:s,animationSpeed:j,selectedSquare:l,validMoves:i,capturedSquare:o,rippleEffect:c,transform3DIntensity:d,particleEffects:u,pieceSize:p,pieceStyle:(null==F?void 0:F.pieceStyle)||"unicode",...x?{onSquareClick:x}:{}}),(0,r.jsxs)("div",{className:"mt-2",children:[(0,r.jsx)("div",{className:"text-xs font-semibold text-gray-700 dark:text-gray-300 mb-1",children:L(v)}),(0,r.jsx)(M,{capturedPieces:m,color:"white",skin:v,pieceStyle:(null==F?void 0:F.pieceStyle)||"unicode"})]}),(0,r.jsx)("div",{className:"mt-4",children:(0,r.jsx)(P,{isCheck:f,isCheckmate:y,isStalemate:w,isDraw:k,currentTurn:g.turn()})})]}),(0,r.jsxs)("div",{className:"lg:w-80 space-y-4",children:[(0,r.jsxs)("div",{className:"flex gap-2 mb-2",children:[(0,r.jsx)("button",{onClick:()=>A(!1),className:"flex-1 py-2 px-4 rounded-lg font-semibold transition-colors duration-200 ".concat(S?"bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300":"bg-blue-600 text-white"),children:"Play"}),(0,r.jsx)("button",{onClick:()=>A(!0),className:"flex-1 py-2 px-4 rounded-lg font-semibold transition-colors duration-200 ".concat(S?"bg-blue-600 text-white":"bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300"),children:"Replay"})]}),S?(0,r.jsx)(I,{onReplay:B,onStop:O,isReplaying:N,disabled:_}):(0,r.jsx)(R,{onMove:E,disabled:_||N,error:q}),(0,r.jsxs)("div",{className:"bg-slate-100 dark:bg-slate-700 rounded-lg p-4",children:[(0,r.jsx)("h2",{className:"font-semibold text-gray-900 dark:text-white mb-2",children:"Move History"}),(0,r.jsx)("div",{className:"max-h-64 overflow-y-auto space-y-1",children:0===h.length?(0,r.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"No moves yet"}):(0,r.jsx)("div",{className:"text-sm font-mono",children:h.map((e,t)=>(0,r.jsxs)("div",{className:"text-gray-700 dark:text-gray-300 py-1",children:[Math.floor(t/2)+1,". ",t%2==0?"":h[t-1]+" ",e]},t))})})]}),(0,r.jsx)(T,{selectedSkin:v,onSkinChange:z}),F&&H&&(0,r.jsx)(W,{settings:F,onSettingsChange:H}),(0,r.jsxs)("div",{className:"bg-slate-100 dark:bg-slate-700 rounded-lg p-4","data-testid":"animation-speed-section",children:[(0,r.jsx)("h2",{className:"font-semibold text-gray-900 dark:text-white mb-3",children:"Animation Speed"}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsx)("span",{className:"text-sm text-gray-700 dark:text-gray-300","data-testid":"animation-speed-label",children:"Speed"}),(0,r.jsxs)("span",{className:"text-sm font-semibold text-gray-900 dark:text-white","data-testid":"animation-speed-percentage",children:[j,"%"]})]}),(0,r.jsx)("input",{type:"range",min:"0",max:"200",step:"10",value:j,onChange:e=>X(parseInt(e.target.value,10)),className:"w-full h-2 bg-gray-200 dark:bg-gray-600 rounded-lg appearance-none cursor-pointer accent-blue-600","data-testid":"animation-speed-slider",style:{background:"linear-gradient(to right, rgb(37, 99, 235) 0%, rgb(37, 99, 235) ".concat(j/200*100,"%, rgb(229, 231, 235) ").concat(j/200*100,"%, rgb(229, 231, 235) 100%)")}}),(0,r.jsxs)("div",{className:"flex justify-between text-xs text-gray-500 dark:text-gray-400",children:[(0,r.jsx)("span",{children:"0%"}),(0,r.jsx)("span",{children:"100%"}),(0,r.jsx)("span",{children:"200%"})]}),(0,r.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-2",children:0===j?"Instant (no animation)":j<100?"Slower":100===j?"Normal speed":"Faster"})]})]}),(0,r.jsxs)("div",{className:"bg-slate-100 dark:bg-slate-700 rounded-lg p-4",children:[(0,r.jsx)("h2",{className:"font-semibold text-gray-900 dark:text-white mb-3",children:"Board Management"}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("button",{onClick:Z,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors duration-200 flex items-center justify-center gap-2",children:[(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),"Copy Board"]}),(0,r.jsxs)("button",{onClick:()=>K(!0),className:"w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors duration-200 flex items-center justify-center gap-2",children:[(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),"Load Board"]})]})]}),(0,r.jsx)("button",{onClick:Y,className:"w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors duration-200",children:"Reset Game"})]})]}),U&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-white dark:bg-slate-800 rounded-lg p-6 max-w-md w-full mx-4 shadow-xl",children:[(0,r.jsx)("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-4",children:"Load Board Position"}),(0,r.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:"Paste the copied board position (text or JSON format):"}),(0,r.jsx)("textarea",{value:V,onChange:e=>J(e.target.value),placeholder:"Paste board position here...",className:"w-full h-32 p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-700 text-gray-900 dark:text-white font-mono text-sm resize-none"}),(0,r.jsxs)("div",{className:"flex gap-2 mt-4",children:[(0,r.jsx)("button",{onClick:()=>{V.trim()&&(Q(V),J(""),K(!1))},disabled:!V.trim(),className:"flex-1 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-semibold py-2 px-4 rounded-lg transition-colors duration-200",children:"Load"}),(0,r.jsx)("button",{onClick:()=>{K(!1),J("")},className:"flex-1 bg-gray-300 dark:bg-gray-600 hover:bg-gray-400 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 font-semibold py-2 px-4 rounded-lg transition-colors duration-200",children:"Cancel"})]})]})})]})}function A(){let[e]=(0,n.useState)(()=>new s.qQ),[t,a]=(0,n.useState)(e.fen()),[o,c]=(0,n.useState)(void 0),[u,p]=(0,n.useState)(null),[x,g]=(0,n.useState)([]),[m,b]=(0,n.useState)(null),[y,k]=(0,n.useState)(!1),[v,j]=(0,n.useState)(!1),S=(0,n.useRef)(null),N=(0,n.useRef)(null),[C,_]=(0,n.useState)([]),[q,E]=(0,n.useState)([]),[M,P]=(0,n.useState)(l.i_),[B,L]=(0,n.useState)(!1),[D,O]=(0,n.useState)(100),[R,I]=(0,n.useState)(null),[T,z]=(0,n.useState)([]),[W,G]=(0,n.useState)(null),A=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:768,[t,a]=(0,n.useState)(()=>window.innerWidth<e);return(0,n.useEffect)(()=>{if(!window.matchMedia){let t=()=>{a(window.innerWidth<e)};return t(),window.addEventListener("resize",t),window.addEventListener("orientationchange",t),()=>{window.removeEventListener("resize",t),window.removeEventListener("orientationchange",t)}}let t=window.matchMedia("(max-width: ".concat(e-1,"px)"));a(t.matches);let r=e=>{a(e.matches)};return t.addEventListener?(t.addEventListener("change",r),()=>{t.removeEventListener("change",r)}):t.addListener?(t.addListener(r),()=>{t.removeListener(r)}):void 0},[e]),t}(),[F,H]=(0,n.useState)(!1),[Z,Q]=(0,n.useState)(!1),U=(0,n.useRef)(null);(0,n.useEffect)(()=>{A&&(window.chessGameMobileRef=U)},[A]);let[K,V]=(0,n.useState)(null),[J,$]=(0,n.useState)("info"),[ee,et]=(0,n.useState)(!1),[ea,er]=(0,n.useState)({rippleEffect:!0,transform3DIntensity:"subtle",particleEffects:!1,toastNotifications:!0,pieceSize:80,pieceStyle:"unicode"});(0,n.useEffect)(()=>{L(!0);let e=localStorage.getItem("chess-skin");if(e){let t=(0,l.pX)(e);t&&P(t)}let t=localStorage.getItem("chess-animation-speed");if(t){let e=parseInt(t,10);!isNaN(e)&&e>=0&&e<=200&&O(e)}er(function(){try{let e=localStorage.getItem("chess-visual-effects");if(e){let t=JSON.parse(e);return{...f,...t}}}catch(e){console.error("Error loading visual effects settings:",e)}return f}())},[]);let en=(0,n.useCallback)(e=>{i.log("[ChessGame] Animation speed changed to: ".concat(e,"%")),O(e),localStorage.setItem("chess-animation-speed",e.toString())},[]),es=(0,n.useCallback)(e=>{P(e),localStorage.setItem("chess-skin",e.id)},[]),el=(0,n.useCallback)(e=>{er(e),w(e)},[]);(0,n.useCallback)(e=>{let t={...ea,transform3DIntensity:e};er(t),w(t)},[ea]);let ei=(0,n.useCallback)(r=>{if(!y)try{b(null);let n=e.move(r);if(!n){b("Invalid move. Please use standard chess notation (e.g., e2e4, Nf3, O-O).");return}if(a(e.fen()),g(t=>[...t,e.history({verbose:!1}).slice(-1)[0]||r]),p({from:n.from,to:n.to}),console.log("[SquareSelection] Clearing selection after move",{moveFrom:n.from,moveTo:n.to,previousSelection:R}),i.info("[SquareSelection] Clearing selection after move",{moveFrom:n.from,moveTo:n.to,previousSelection:R}),I(null),z([]),console.log("[SquareSelection] State updated - selectedSquare cleared"),n.captured){if(G(n.to),setTimeout(()=>G(null),600),ea.toastNotifications){let e={p:"Pawn",P:"Pawn",r:"Rook",R:"Rook",n:"Knight",N:"Knight",b:"Bishop",B:"Bishop",q:"Queen",Q:"Queen",k:"King",K:"King"}[n.captured]||"Piece",t="w"===n.color?"White":"Black";V("".concat(t," captured ").concat(e,"!")),$("success"),et(!0)}let e=n.captured,t=n.color,a="w"===t?e:e.toUpperCase();i.log("[Capture] Move: ".concat(n.san,', captured: "').concat(n.captured,'", capturingColor: "').concat(t,'", converted: "').concat(a,'"')),a===a.toUpperCase()&&a!==a.toLowerCase()?_(e=>{let t=[...e,a];return i.log("[Capture] White captured list updated:",t),t}):E(e=>{let t=[...e,a];return i.log("[Capture] Black captured list updated:",t),t})}c(t),setTimeout(()=>{c(void 0)},600)}catch(e){b(e instanceof Error?e.message:"Invalid move notation")}},[e,t,y,R]),eo=(0,n.useCallback)(t=>{if(console.log("[SquareSelection] handleSquareClick called",{square:t,isReplaying:y,isGameOver:e.isGameOver(),currentSelectedSquare:R}),y||e.isGameOver()){console.log("[SquareSelection] Early return - replaying or game over");return}let a=e.get(t),r=e.turn();if(console.log("[SquareSelection] Piece info",{square:t,piece:a?{type:a.type,color:a.color}:null,currentTurn:r}),R){if(R===t){i.info("[SquareSelection] Deselecting square",{square:t,previousSelection:R}),console.log("[SquareSelection] Deselecting square",{square:t,previousSelection:R}),I(null),z([]);return}if(T.includes(t)){let e="".concat(R).concat(t);i.info("[SquareSelection] Making move from selected square",{from:R,to:t,moveNotation:e}),ei(e);return}if(a&&("w"===a.color&&"w"===r||"b"===a.color&&"b"===r)){let n=e.moves({square:t,verbose:!0}),s=[];for(let t of n){let a=e.get(t.to);a?("w"===r&&"b"===a.color||"b"===r&&"w"===a.color)&&s.push(t.to):s.push(t.to)}i.info("[SquareSelection] Changing selection to new piece",{previousSquare:R,newSquare:t,piece:a.type,pieceColor:a.color,validMoves:s,validMoveCount:s.length}),I(t),z(s);return}i.info("[SquareSelection] Clearing selection (invalid click)",{previousSelection:R,clickedSquare:t}),I(null),z([]);return}if(a&&("w"===a.color&&"w"===r||"b"===a.color&&"b"===r)){let n=e.moves({square:t,verbose:!0}),s=[];for(let t of n){let a=e.get(t.to);a?("w"===r&&"b"===a.color||"b"===r&&"w"===a.color)&&s.push(t.to):s.push(t.to)}i.info("[SquareSelection] Selecting square with piece",{square:t,piece:a.type,pieceColor:a.color,currentTurn:r,validMoves:s,validMoveCount:s.length}),console.log("[SquareSelection] Selecting square with piece",{square:t,piece:a.type,pieceColor:a.color,currentTurn:r,validMoves:s,validMoveCount:s.length}),I(t),z(s)}else i.info("[SquareSelection] Clicked empty square or opponent piece, no selection",{square:t,hasPiece:!!a,pieceColor:null==a?void 0:a.color,currentTurn:r}),I(null),z([])},[R,T,e,y,ei]),ec=(0,n.useCallback)(()=>{S.current&&(clearTimeout(S.current),S.current=null),k(!1),j(!1),N.current=null,e.reset(),a(e.fen()),g([]),b(null),_([]),E([]),p(null),R&&i.info("[SquareSelection] Clearing selection on game reset",{previousSelection:R}),I(null),z([]),G(null)},[e,R]),ed=(0,n.useCallback)(t=>{S.current&&clearTimeout(S.current);let r=new s.qQ;N.current=r,k(!0),b(null),e.reset(),a(e.fen()),g([]),_([]),E([]),p(null),I(null),z([]);let n=0,l=()=>{if(n>=t.length||!N.current){k(!1),N.current=null;return}try{let i=t[n],o=r.move(i);if(!o){b("Invalid move at position ".concat(n+1,": ").concat(i)),k(!1),N.current=null;return}let c=[],d=[],u=new s.qQ;for(let e=0;e<=n;e++){let a=u.move(t[e]);if(null==a?void 0:a.captured){let e=a.captured,t=a.color,r="w"===t?e:e.toUpperCase();r===r.toUpperCase()&&r!==r.toLowerCase()?c.push(r):d.push(r)}}_(c),E(d),e.load(r.fen()),a(e.fen()),g(r.history({verbose:!1})),p({from:o.from,to:o.to}),n++,S.current=setTimeout(l,800)}catch(e){b("Error at move ".concat(n+1,": ").concat(e instanceof Error?e.message:"Invalid move")),k(!1),N.current=null}};l()},[e]),eu=(0,n.useCallback)(()=>{S.current&&(clearTimeout(S.current),S.current=null),k(!1),N.current=null},[]),ep=(0,n.useCallback)(async()=>{try{let t=function(e){let t=function(e){let t={},a=["a","b","c","d","e","f","g","h"];for(let r of["1","2","3","4","5","6","7","8"])for(let n of a){let a=n+r,s=e.get(a);if(s){let e="w"===s.color?s.type.toUpperCase():s.type.toLowerCase();t[a]=e}}return t}(e),a=function(e){let t=[],a=[];for(let r of Object.keys(e).sort()){let n=e[r],s=n===n.toUpperCase()?"White":"Black",l=h[n]||"Unknown",i="".concat(l," on ").concat(r);"White"===s?t.push(i):a.push(i)}let r="";return t.length>0&&(r+="White: ".concat(t.join(", "))),a.length>0&&(r&&(r+="\n"),r+="Black: ".concat(a.join(", "))),r||"Empty board"}(t),r=JSON.stringify(t,null,2);return"".concat(a,"\n\n--- JSON Format ---\n").concat(r)}(e);await navigator.clipboard.writeText(t),V("Board position copied to clipboard!"),$("success"),et(!0),i.log("[BoardCopy] Board position copied to clipboard")}catch(e){i.error("[BoardCopy] Failed to copy board position",e),V("Failed to copy board position"),$("error"),et(!0)}},[e]),ex=(0,n.useCallback)(t=>{if(y){V("Cannot load board during replay"),$("warning"),et(!0);return}try{let r=function(e){if(!e||!e.trim())return null;let t=e.trim();if(t.startsWith("{"))try{let e=JSON.parse(t);if("object"==typeof e&&null!==e)return e}catch(e){}if(t.includes(":")&&!t.includes(" on ")){let e={};for(let a of t.split(/\s+/)){let[t,r]=a.split(":");t&&r&&/^[a-h][1-8]$/.test(t)&&/^[prnbqkPRNBQK]$/.test(r)&&(e[t]=r)}if(Object.keys(e).length>0)return e}let a={};for(let e of t.split("\n"))if(e.includes(" on "))for(let t of e.split(/[:,]/).slice(1)){let e=t.match(/([PRNBQKprnbqk])\s+on\s+([a-h][1-8])/);if(e){let[,t,r]=e;a[r]=t}}return Object.keys(a).length>0?a:null}(t);if(!r){V("Invalid board format. Please check the copied text."),$("error"),et(!0);return}!function(e,t){try{let a=["a","b","c","d","e","f","g","h"],r=[];for(let e of["8","7","6","5","4","3","2","1"]){let n="",s=0;for(let r of a){let a=t[r+e];a?(s>0&&(n+=s.toString(),s=0),n+=a):s++}s>0&&(n+=s.toString()),r.push(n)}let n=r.join("/"),s=e.fen().split(" "),l="".concat(n," ").concat(s.slice(1).join(" "));return e.load(l),!0}catch(e){return console.error("Error loading board state:",e),!1}}(e,r)?(V("Failed to load board position"),$("error"),et(!0)):(a(e.fen()),g([]),_([]),E([]),p(null),I(null),z([]),b(null),V("Board position loaded successfully!"),$("success"),et(!0),i.log("[BoardLoad] Board position loaded successfully"))}catch(e){i.error("[BoardLoad] Error loading board position",e),V("Error loading board position"),$("error"),et(!0)}},[e,y]);(0,n.useEffect)(()=>()=>{S.current&&clearTimeout(S.current)},[]);let eg=e.isGameOver(),eh=e.isCheck(),em=e.isCheckmate(),eb=e.isStalemate(),ef=e.isDraw(),ey=e.turn();return(0,n.useEffect)(()=>{em?(V("Checkmate! ".concat("w"===ey?"Black":"White"," wins!")),$("error"),et(!0)):eb?(V("Stalemate! The game is a draw."),$("warning"),et(!0)):ef?(V("Draw!"),$("warning"),et(!0)):eh&&(V("Check! ".concat("w"===ey?"White":"Black"," is in check.")),$("warning"),et(!0))},[eh,em,eb,ef,ey]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(d,{message:K||"",type:J,isVisible:ee,onClose:()=>et(!1),duration:em||eb||ef?6e3:3e3}),A?(0,r.jsx)(X,{ref:U,fen:t,previousFen:o,lastMove:u,selectedSquare:R,validMoves:T,capturedSquare:W,rippleEffect:ea.rippleEffect,transform3DIntensity:ea.transform3DIntensity,particleEffects:ea.particleEffects,pieceSize:ea.pieceSize,...y||eg?{}:{onSquareClick:eo},chess:e,moveHistory:x,capturedWhite:C,capturedBlack:q,isCheck:eh,isCheckmate:em,isStalemate:eb,isDraw:ef,selectedSkin:M,animationSpeed:D,replayMode:v,isReplaying:y,isGameOver:eg,error:m,isRightDrawerOpen:F,isLeftDrawerOpen:Z,setIsRightDrawerOpen:H,setIsLeftDrawerOpen:Q,onMove:ei,onReplay:ed,onStopReplay:eu,onSkinChange:es,onAnimationSpeedChange:en,onResetGame:ec,onSetReplayMode:j,visualEffects:ea,onVisualEffectsChange:el,onCopyBoard:ep,onLoadBoard:ex}):(0,r.jsx)(Y,{fen:t,previousFen:o,lastMove:u,selectedSquare:R,validMoves:T,capturedSquare:W,rippleEffect:ea.rippleEffect,transform3DIntensity:ea.transform3DIntensity,particleEffects:ea.particleEffects,pieceSize:ea.pieceSize,...y||eg?{}:{onSquareClick:eo},chess:e,moveHistory:x,capturedWhite:C,capturedBlack:q,isCheck:eh,isCheckmate:em,isStalemate:eb,isDraw:ef,selectedSkin:M,animationSpeed:D,replayMode:v,isReplaying:y,isGameOver:eg,error:m,onMove:ei,onReplay:ed,onStopReplay:eu,onSkinChange:es,onAnimationSpeedChange:en,onResetGame:ec,onSetReplayMode:j,visualEffects:ea,onVisualEffectsChange:el,onCopyBoard:ep,onLoadBoard:ex})]})}function F(){return(0,r.jsx)("main",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 flex items-center justify-center p-4",children:(0,r.jsx)(A,{})})}},2746:function(e,t,a){"use strict";a.d(t,{g6:function(){return s},i_:function(){return i},pX:function(){return l}});let r=[{id:"classic",name:"Classic",lightSquare:"bg-white dark:bg-gray-100",darkSquare:"bg-gray-300 dark:bg-gray-400"},{id:"wood",name:"Wood",lightSquare:"bg-amber-50 dark:bg-amber-100",darkSquare:"bg-amber-800 dark:bg-amber-900"},{id:"marble",name:"Marble",lightSquare:"bg-stone-100 dark:bg-stone-200",darkSquare:"bg-stone-600 dark:bg-stone-700"},{id:"green",name:"Green",lightSquare:"bg-green-100 dark:bg-green-200",darkSquare:"bg-green-700 dark:bg-green-800"},{id:"blue",name:"Blue",lightSquare:"bg-blue-100 dark:bg-blue-200",darkSquare:"bg-blue-700 dark:bg-blue-800"},{id:"purple",name:"Purple",lightSquare:"bg-purple-100 dark:bg-purple-200",darkSquare:"bg-purple-700 dark:bg-purple-800"}],n=[{id:"yellow-black",name:"Yellow & Black",whitePiece:"text-yellow-500",blackPiece:"text-gray-900",whitePieceShadow:"[text-shadow:_-1px_-1px_0_rgb(0,0,0),_1px_-1px_0_rgb(0,0,0),_-1px_1px_0_rgb(0,0,0),_1px_1px_0_rgb(0,0,0)] drop-shadow-[0_2px_4px_rgba(0,0,0,0.8)]",blackPieceShadow:"drop-shadow-[0_1px_2px_rgba(255,255,255,0.3)]"},{id:"white-black",name:"White & Black",whitePiece:"text-white",blackPiece:"text-gray-900",whitePieceShadow:"drop-shadow-[0_2px_4px_rgba(0,0,0,0.8)]",blackPieceShadow:"drop-shadow-[0_1px_2px_rgba(255,255,255,0.3)]"},{id:"gold-silver",name:"Gold & Silver",whitePiece:"text-yellow-400",blackPiece:"text-gray-400",whitePieceShadow:"[text-shadow:_-1px_-1px_0_rgb(0,0,0),_1px_-1px_0_rgb(0,0,0),_-1px_1px_0_rgb(0,0,0),_1px_1px_0_rgb(0,0,0)] drop-shadow-[0_2px_4px_rgba(0,0,0,0.8)]",blackPieceShadow:"[text-shadow:_-1px_-1px_0_rgb(0,0,0),_1px_-1px_0_rgb(0,0,0),_-1px_1px_0_rgb(0,0,0),_1px_1px_0_rgb(0,0,0)] drop-shadow-[0_2px_4px_rgba(0,0,0,0.8)]"},{id:"red-blue",name:"Red & Blue",whitePiece:"text-red-600",blackPiece:"text-blue-700",whitePieceShadow:"[text-shadow:_-1px_-1px_0_rgb(0,0,0),_1px_-1px_0_rgb(0,0,0),_-1px_1px_0_rgb(0,0,0),_1px_1px_0_rgb(0,0,0)] drop-shadow-[0_2px_4px_rgba(0,0,0,0.8)]",blackPieceShadow:"[text-shadow:_-1px_-1px_0_rgb(255,255,255),_1px_-1px_0_rgb(255,255,255),_-1px_1px_0_rgb(255,255,255),_1px_1px_0_rgb(255,255,255)] drop-shadow-[0_2px_4px_rgba(255,255,255,0.8)]"},{id:"orange-teal",name:"Orange & Teal",whitePiece:"text-orange-500",blackPiece:"text-teal-700",whitePieceShadow:"[text-shadow:_-1px_-1px_0_rgb(0,0,0),_1px_-1px_0_rgb(0,0,0),_-1px_1px_0_rgb(0,0,0),_1px_1px_0_rgb(0,0,0)] drop-shadow-[0_2px_4px_rgba(0,0,0,0.8)]",blackPieceShadow:"[text-shadow:_-1px_-1px_0_rgb(255,255,255),_1px_-1px_0_rgb(255,255,255),_-1px_1px_0_rgb(255,255,255),_1px_1px_0_rgb(255,255,255)] drop-shadow-[0_2px_4px_rgba(255,255,255,0.8)]"}],s=[{id:"classic-yellow",name:"Classic Yellow",board:r[0],pieces:n[0]},{id:"wood-white",name:"Wood White",board:r[1],pieces:n[1]},{id:"marble-gold",name:"Marble Gold",board:r[2],pieces:{id:"gold-marble-enhanced",name:"Gold Enhanced",whitePiece:"text-amber-600",blackPiece:"text-gray-400",whitePieceShadow:"drop-shadow-[0_3px_6px_rgba(0,0,0,1),0_0_4px_rgba(0,0,0,1)]",blackPieceShadow:"[text-shadow:_-1px_-1px_0_rgb(0,0,0),_1px_-1px_0_rgb(0,0,0),_-1px_1px_0_rgb(0,0,0),_1px_1px_0_rgb(0,0,0)] drop-shadow-[0_2px_4px_rgba(0,0,0,0.8)]"}},{id:"green-red-blue",name:"Green Red/Blue",board:r[3],pieces:n[3]},{id:"blue-orange-teal",name:"Blue Orange/Teal",board:r[4],pieces:n[4]},{id:"purple-gold",name:"Purple Gold",board:r[5],pieces:n[2]}];function l(e){return s.find(t=>t.id===e)}function i(){return s[0]}}},function(e){e.O(0,[648,673,971,117,744],function(){return e(e.s=6514)}),_N_E=e.O()}]);